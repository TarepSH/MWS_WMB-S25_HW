generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum OrderStatus {
  pending
  confirmed
  delivered
  canceled
}

enum PaymentMethod {
  card
  PayPal
  cash
}

enum PaymentStatus {
  pending
  paid
  failed
  refunded
}

enum DeliveryStatus {
  assigned
  on_the_way
  delivered
}

enum DriverAvailabilityStatus {
  available
  unavailable
}

enum MenuAvailabilityStatus {
  available
  unavailable
}

model User {
  userId       Int      @id @default(autoincrement()) @map("user_id")
  name         String
  email        String   @unique
  phone        String?
  passwordHash String   @map("password_hash")
  address      String?
  createdAt    DateTime @default(now()) @map("created_at")

  orders  Order[]
  reviews Review[]

  @@map("users")
}

model Restaurant {
  restaurantId Int    @id @default(autoincrement()) @map("restaurant_id")
  name         String
  address      String
  phone        String
  rating       Float  @default(0)
  cuisineType  String @map("cuisine_type")

  menus   Menu[]
  orders  Order[]
  reviews Review[]

  @@map("restaurants")
}

model Menu {
  menuId             Int                    @id @default(autoincrement()) @map("menu_id")
  restaurantId       Int                    @map("restaurant_id")
  itemName           String                 @map("item_name")
  description        String
  price              Decimal
  imageUrl           String                 @map("image_url")
  availabilityStatus MenuAvailabilityStatus @default(available) @map("availability_status")

  restaurant Restaurant @relation(fields: [restaurantId], references: [restaurantId])
  orderItems OrderItem[]

  @@index([restaurantId])
  @@map("menus")
}

model Order {
  orderId       Int         @id @default(autoincrement()) @map("order_id")
  userId        Int         @map("user_id")
  restaurantId  Int         @map("restaurant_id")
  orderStatus   OrderStatus @default(pending) @map("order_status")
  totalAmount   Decimal     @map("total_amount")
  createdAt     DateTime    @default(now()) @map("created_at")

  user       User       @relation(fields: [userId], references: [userId])
  restaurant Restaurant @relation(fields: [restaurantId], references: [restaurantId])
  orderItems OrderItem[]
  payments   Payment[]
  delivery   Delivery?
  review     Review?

  @@index([userId])
  @@index([restaurantId])
  @@map("orders")
}

model OrderItem {
  orderItemId Int     @id @default(autoincrement()) @map("order_item_id")
  orderId     Int     @map("order_id")
  menuId      Int     @map("menu_id")
  quantity    Int
  price       Decimal

  order Order @relation(fields: [orderId], references: [orderId])
  menu  Menu  @relation(fields: [menuId], references: [menuId])

  @@index([orderId])
  @@index([menuId])
  @@map("order_items")
}

model Payment {
  paymentId      Int           @id @default(autoincrement()) @map("payment_id")
  orderId        Int           @map("order_id")
  paymentMethod  PaymentMethod @map("payment_method")
  paymentStatus  PaymentStatus @default(pending) @map("payment_status")
  transactionId  String?       @map("transaction_id")
  amount         Decimal
  paidAt         DateTime?      @map("paid_at")

  order Order @relation(fields: [orderId], references: [orderId])

  @@index([orderId])
  @@map("payments")
}

model Delivery {
  deliveryId     Int            @id @default(autoincrement()) @map("delivery_id")
  orderId        Int            @unique @map("order_id")
  driverId       Int            @map("driver_id")
  deliveryStatus DeliveryStatus @default(assigned) @map("delivery_status")
  estimatedTime  DateTime?      @map("estimated_time")
  actualTime     DateTime?      @map("actual_time")

  order  Order  @relation(fields: [orderId], references: [orderId])
  driver Driver @relation(fields: [driverId], references: [driverId])

  @@index([driverId])
  @@map("delivery")
}

model Driver {
  driverId            Int                     @id @default(autoincrement()) @map("driver_id")
  name                String
  phone               String
  vehicleType         String                  @map("vehicle_type")
  availabilityStatus  DriverAvailabilityStatus @default(available) @map("availability_status")

  deliveries Delivery[]

  @@map("drivers")
}

model Review {
  reviewId     Int      @id @default(autoincrement()) @map("review_id")
  userId       Int      @map("user_id")
  restaurantId Int      @map("restaurant_id")
  orderId      Int      @unique @map("order_id")
  rating       Int
  comment      String?
  createdAt    DateTime @default(now()) @map("created_at")

  user       User       @relation(fields: [userId], references: [userId])
  restaurant Restaurant @relation(fields: [restaurantId], references: [restaurantId])
  order      Order      @relation(fields: [orderId], references: [orderId])

  @@index([userId])
  @@index([restaurantId])
  @@map("reviews")
}
